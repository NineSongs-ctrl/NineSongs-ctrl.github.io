<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ontario Promise Tracker</title>
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Exo+2&family=Roboto+Condensed&display=swap" rel="stylesheet">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <style>
    :root {
      --primary: #1a73e8; /* Blue */
      --background: #1a1a1a; /* Black */
      --text: #fff; /* White */
      --accent: #333; /* Grey */
      --shadow: rgba(0, 0, 0, 0.8);
      --status-kept: #00FF00; /* Green for kept */
      --status-in-progress: #FF8C00; /* Orange for in progress */
      --status-not-started: #FFFF00; /* Yellow for not started */
      --status-broken: #FF0000; /* Red for broken */
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: 'Roboto Condensed', sans-serif;
      background: var(--background);
      color: var(--text);
      line-height: 1.5;
      padding: 0 20px;
    }
    a {
      color: var(--primary);
      text-decoration: none;
    }
    a:hover {
      text-decoration: underline;
    }

    /* Pop-up */
    .popup {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.85);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }
    .popup-content {
      background: var(--accent);
      padding: 40px;
      border-left: 5px solid var(--primary);
      max-width: 90vw;
      max-height: 90vh;
      overflow-y: auto;
      color: var(--text);
      font-size: 1.2rem;
      line-height: 1.8;
    }
    .popup-content h2 {
      font-family: 'Exo 2', sans-serif;
      font-size: 2.5rem;
      text-transform: uppercase;
      margin-bottom: 20px;
      text-align: center;
    }
    .popup-content p {
      margin-bottom: 15px;
      text-align: justify;
    }
    .emphasis {
      color: var(--primary);
      font-weight: bold;
      text-transform: uppercase;
    }
    .signature {
      text-align: right;
      font-size: 1.5rem;
      margin-top: 30px;
      opacity: 0.8;
      font-style: italic;
    }
    .continue-btn {
      background: var(--primary);
      color: var(--text);
      border: none;
      padding: 15px 30px;
      cursor: pointer;
      font-family: 'Exo 2', sans-serif;
      font-size: 1.2rem;
      text-transform: uppercase;
      margin-top: 20px;
      transition: background 0.3s ease;
      display: block;
      margin-left: auto;
      margin-right: auto;
    }
    .continue-btn:hover {
      background: #0a63c8;
    }

    /* Header */
    header {
      background: linear-gradient(to right, #0a2463, #1a73e8);
      padding: 60px 0;
      text-align: center;
      box-shadow: 0 4px 10px var(--shadow);
    }
    header h1 {
      font-family: 'Exo 2', sans-serif;
      font-size: 4rem;
      text-transform: uppercase;
      letter-spacing: 3px;
      color: #fff;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
    }

    /* Statistics */
    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin: 40px 0;
    }
    .stat-card {
      background: var(--accent);
      padding: 20px;
      text-align: center;
      border-top: 4px solid var(--primary);
      border-bottom: 2px solid var(--primary);
      transition: transform 0.3s ease;
    }
    .stat-card:hover {
      transform: translateY(-5px);
    }
    .stat-card i {
      font-size: 2.5rem;
      margin-bottom: 10px;
    }
    .stat-card.kept i { color: var(--status-kept); }
    .stat-card.in-progress i { color: var(--status-in-progress); }
    .stat-card.not-started i { color: var(--status-not-started); }
    .stat-card.broken i { color: var(--status-broken); }
    .stat-card h3 {
      font-family: 'Exo 2', sans-serif;
      font-size: 1.2rem;
      text-transform: uppercase;
    }
    .stat-card p {
      font-size: 2rem;
      font-weight: bold;
    }

    /* Filters */
    .filters {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin: 20px 0;
      padding: 15px;
      background: var(--accent);
      border-left: 5px solid var(--primary);
      position: sticky;
      top: 0;
      z-index: 10;
    }
    .search-box input {
      padding: 10px 15px;
      width: 300px;
      background: #222;
      border: 1px solid var(--primary);
      color: var(--text);
      font-family: 'Roboto Condensed', sans-serif;
      font-size: 1rem;
    }
    .search-box input:focus {
      outline: none;
      border-color: #fff;
    }
    .sort select {
      padding: 10px;
      background: #222;
      border: 1px solid var(--primary);
      color: var(--text);
      font-family: 'Roboto Condensed', sans-serif;
      font-size: 1rem;
    }

    /* Promise List */
    .promise-list {
      margin-top: 20px;
    }
    .promise-list-item {
      display: flex;
      align-items: flex-start;
      padding: 15px;
      border-bottom: 1px solid #eee;
      transition: background 0.3s ease;
      background: var(--background);
    }
    .promise-list-item.kept { background: rgba(0, 255, 0, 0.1); } /* Green highlight */
    .promise-list-item.in-progress { background: rgba(255, 140, 0, 0.1); } /* Orange highlight */
    .promise-list-item.not-yet-rated { background: rgba(255, 255, 0, 0.1); } /* Yellow highlight */
    .promise-list-item.broken { background: rgba(255, 0, 0, 0.1); } /* Red highlight */
    .promise-list-item:hover {
      background: #2a2a2a;
    }
    .promise-list-item__status {
      flex: 0 0 60px;
      text-align: center;
    }
    .promise-list-item__status-icon {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      margin-bottom: 5px;
    }
    .promise-list-item__status-icon.kept { background: var(--status-kept); }
    .promise-list-item__status-icon.in-progress { background: var(--status-in-progress); }
    .promise-list-item__status-icon.not-yet-rated { background: var(--status-not-started); }
    .promise-list-item__status-icon.broken { background: var(--status-broken); }
    .promise-list-item__status-info {
      font-size: 0.8rem;
      color: #888;
    }
    .promise-list-item__title {
      flex: 1;
      padding: 0 15px;
    }
    .promise-list-item__title a {
      text-decoration: none;
      color: var(--text);
    }
    .promise-list-item__title a:hover {
      text-decoration: underline;
    }
    .promise-list-item__right {
      flex: 0 0 80px;
      text-align: right;
      font-size: 0.9rem;
      color: var(--primary);
    }

    /* Loading/Error Message */
    #loading-message {
      text-align: center;
      padding: 20px;
      font-size: 1.2rem;
    }
  </style>
</head>
<body>
  <!-- Open Letter Pop-Up -->
  <div class="popup" id="popup">
    <div class="popup-content">
      <h2>Open Letter to the PC Party of Ontario</h2>
      <p>To the PC Party of Ontario,</p>
      <p>In a polling location, I witnessed diverse amounts of people from every background, ethnicity, gender, and religion. From the bright-eyed curiosity of children, the resolute determination of young adults casting their first ever ballot, to mothers and fathers balancing civic duty with familial love, and seniors whose wisdom spans generations, each person came driven by a passion to vote for a better tomorrow.</p>
      <p>I witnessed acts of kindness that show the very essence of our Canadian spirit. Strangers holding doors open for one another, exchanging warm smiles and sharing hopeful words about the future. In every corner of the polling station, there was a unifying truth: each vote was not just a mark on a ballot but a testament to the enduring belief in democracy and the hope for a brighter future.</p>
      <p>I implore you, as the custodians of our province’s destiny, to approach your tenure with unwavering integrity and transparency. The promises you made during your campaigns are not mere political talking points; they are lifelines for families striving for better education, affordable housing and cheaper groceries; for individuals yearning for accessible healthcare; for communities working toward sustainable growth; and for the marginalized desiring equitable opportunities. These commitments embody the dreams and aspirations of every Ontarian who has placed their trust in you.</p>
      <p>So when the confetti settles and the headlines fade, remember the man who cast his vote from a hospice bed, his ballot a final act of faith. Recall the student who skipped lunch to join the line, believing that a single vote could mend their hunger. Recall the seniors that made it their day's mission to go out and cast their vote.</p>
      <p>To you who will lead: carry these people in your very bones. Let them echo in every podium speech, every policy debate, every late night discussion. You are not merely inheriting power; you are entrusted with hope. Do not dilute it with empty rhetoric or betray it through complacency.</p>
      <p>Be the leader who sees a parent’s silent tears at every cut to education; who hears the distant roar of wildfires in every compromise on the environment; who feels the tremor in a senior’s hand when housing becomes a luxury; who sees the young struggling with their mental and physical health due to inadequate healthcare.</p>
      <p class="emphasis">This is your task. Be bold. Be compassionate. Be accountable. But above all, be worthy of them.</p>
      <div class="signature">A Concerned Citizen of Ontario</div>
      <button class="continue-btn" onclick="hidePopup()" aria-label="Continue to Tracker">Continue</button>
    </div>
  </div>

  <!-- Header -->
  <header>
    <h1>Ontario Promise Tracker</h1>
  </header>

  <!-- Statistics -->
  <div class="stats">
    <div class="stat-card kept">
      <i class="fas fa-check-circle"></i>
      <h3>Kept</h3>
      <p id="kept-count">0</p>
    </div>
    <div class="stat-card in-progress">
      <i class="fas fa-cogs"></i>
      <h3>In Progress</h3>
      <p id="in-progress-count">0</p>
    </div>
    <div class="stat-card not-started">
      <i class="fas fa-pause-circle"></i>
      <h3>Not Started</h3>
      <p id="not-started-count">0</p>
    </div>
    <div class="stat-card broken">
      <i class="fas fa-times-circle"></i>
      <h3>Broken</h3>
      <p id="broken-count">0</p>
    </div>
  </div>

  <!-- Filters -->
  <div class="filters">
    <div class="search-box">
      <input type="text" placeholder="Search Promises..." aria-label="Search promises">
    </div>
    <div class="sort">
      <select aria-label="Sort by">
        <option value="last_updated">Sort by Last Updated</option>
        <option value="promise_id">Sort by Promise ID</option>
      </select>
    </div>
  </div>

  <!-- Loading/Error Message -->
  <div id="loading-message">Loading promises...</div>

  <!-- Promise List -->
  <div class="promise-list" id="promise-list" style="display: none;"></div>

  <!-- Party Info -->
  <footer class="party-info">
    <h3>Current Party: PC Party of Ontario</h3>
    <p><strong>Leader:</strong> Doug Ford</p>
  </footer>

  <script>
    // Show pop-up and fetch promises on load
    document.addEventListener('DOMContentLoaded', function() {
      document.getElementById('popup').style.display = 'flex';
      fetchPromises();
    });

    // Hide pop-up
    function hidePopup() {
      document.getElementById('popup').style.display = 'none';
    }

    // Close pop-up when clicking outside
    document.getElementById('popup').addEventListener('click', function(e) {
      if (e.target === this) hidePopup();
    });

    // Fetch promises from Polimeter via proxy
    async function fetchPromises() {
      const loadingMessage = document.getElementById('loading-message');
      const promiseList = document.getElementById('promise-list');
      loadingMessage.textContent = 'Loading promises...';
      promiseList.style.display = 'none';

      const proxyUrl = 'https://api.allorigins.win/get?url=' + encodeURIComponent('https://www.polimeter.org/en/ford?gb=ungrouped&sb=progress_desc');

      try {
        const response = await fetch(proxyUrl);
        if (!response.ok) throw new Error('Network response was not ok');
        const data = await response.json();
        const htmlContent = data.contents;

        // Parse Polimeter's HTML
        const parser = new DOMParser();
        const doc = parser.parseFromString(htmlContent, 'text/html');
        const promiseElements = doc.querySelectorAll('.promise-list-item');

        const promises = Array.from(promiseElements).map(elem => {
          const statusIcon = elem.querySelector('.promise-list-item__status-icon');
          const statusText = elem.querySelector('.promise-list-item__status-info-name')?.textContent.trim().toLowerCase() || 'not-yet-rated';
          const statusColor = statusIcon ? window.getComputedStyle(statusIcon)?.backgroundColor || '#666' : '#666';
          const promiseId = elem.querySelector('.promise-list-item__title-text a p')?.textContent.match(/(\d+\.\d+\.\d+)/)?.[0] || 'Unknown';
          const title = elem.querySelector('.promise-list-item__title-text a p')?.textContent.trim() || 'Unknown Promise';
          const lastUpdated = elem.querySelector('.promise-list-item__status-info-date')?.textContent.trim() || '03-Mar-2025';
          const sourceUrl = elem.querySelector('.promise-list-item__title-text a')?.href || 'https://www.polimeter.org/en/ford';
          const sourceName = 'Polimeter';

          let statusClass;
          switch (statusText) {
            case 'kept': statusClass = 'kept'; break;
            case 'in progress': statusClass = 'in-progress'; break;
            case 'not yet rated': statusClass = 'not-yet-rated'; break;
            case 'broken': statusClass = 'broken'; break;
            default: statusClass = 'not-yet-rated';
          }

          return {
            id: promiseId,
            title: title,
            status: statusClass,
            statusColor: statusColor,
            last_updated: lastUpdated,
            source_url: sourceUrl,
            source_name: sourceName,
            details: elem.querySelector('.promise-details')?.textContent?.trim() || 'Details not available'
          };
        });

        // If no promises found, use fallback
        if (promises.length === 0) {
          promises.push(...getFallbackPromises());
        }

        renderPromises(promises);
        loadingMessage.style.display = 'none';
        promiseList.style.display = 'block';
      } catch (error) {
        console.error('Error fetching promises:', error);
        loadingMessage.textContent = 'Failed to load promises. Using sample data.';
        renderPromises(getFallbackPromises());
        promiseList.style.display = 'block';
      }
    }

    // Fallback promises
    function getFallbackPromises() {
      return [
        {
          id: "2.04.002",
          title: "Invest $1 billion over the next three years to boost skilled trades.",
          status: "in-progress",
          statusColor: "#FF8C00",
          last_updated: "22-Jul-2024",
          source_url: "https://www.ontario.ca/page/ontario-budget-2022",
          source_name: "Ontario Budget 2022",
          details: "Fully funded initiative launched in 2022, with programs active across Ontario."
        },
        {
          id: "2.04.021",
          title: "Build Highway 413 to reduce traffic and congestion in the Greater Toronto Area (GTA).",
          status: "broken",
          statusColor: "#FF0000",
          last_updated: "17-Jul-2024",
          source_url: "https://news.ontario.ca/en/release/1003189",
          source_name: "Infrastructure Update",
          details: "Construction delayed indefinitely due to budget constraints."
        },
        {
          id: "1.06.022",
          title: "Clean up our communities: Commit resources to reduce garbage in our neighbourhoods and parks.",
          status: "not-yet-rated",
          statusColor: "#FFFF00",
          last_updated: "01-Jan-2025",
          source_url: "https://www.ontario.ca/page/community-clean-up",
          source_name: "Community Clean-Up Program",
          details: "Initiative announced but no action taken yet."
        },
        {
          id: "2.04.010",
          title: "Reduce gas taxes to lower fuel costs for Ontario drivers.",
          status: "kept",
          statusColor: "#00FF00",
          last_updated: "31-Dec-2023",
          source_url: "https://news.ontario.ca/en/release/1003189",
          source_name: "Gas Tax Reduction Announcement",
          details: "Gas tax reduced by 5.7 cents per litre through 2023."
        }
      ];
    }

    // Render promises into the list
    function renderPromises(promises) {
      const promiseList = document.getElementById('promise-list');
      promiseList.innerHTML = '';
      promises.forEach(promise => {
        const item = document.createElement('div');
        item.className = `promise-list-item ${promise.status}`;
        item.dataset.status = promise.status; // Ensure data-status is set
        item.innerHTML = `
          <div class="promise-list-item__status">
            <div class="promise-list-item__status-icon" style="background: ${promise.statusColor}">
              <i class="fas fa-${getIcon(promise.status)}"></i>
            </div>
            <div class="promise-list-item__status-info">
              <div class="promise-list-item__status-info-name">${promise.status.replace('-', ' ').replace(/\b\w/g, l => l.toUpperCase())}</div>
              <div class="promise-list-item__status-info-date">${promise.last_updated}</div>
            </div>
          </div>
          <div class="promise-list-item__title">
            <div class="promise-list-item__title-text">
              <a href="${promise.source_url}" target="_blank"><p>${promise.title}</p></a>
            </div>
            <div class="promise-list-item__title-read-more">
              <a class="promise-list-item__right-link" href="${promise.source_url}" target="_blank">Read More</a>
            </div>
          </div>
          <div class="promise-list-item__right">
            <div class="promise-list-item__right-social-holder">
              <button class="share-button" onclick="alert('Share on Twitter: ${promise.title}')">
                <i class="fab fa-twitter"></i>
              </button>
              <button class="share-button" onclick="alert('Share on Facebook: ${promise.title}')">
                <i class="fab fa-facebook"></i>
              </button>
            </div>
          </div>
        `;
        promiseList.appendChild(item);
      });
      updateStats();
      addEventListeners();
    }

    function getIcon(status) {
      switch (status) {
        case 'kept': return 'check-circle';
        case 'in-progress': return 'cogs';
        case 'not-yet-rated': return 'pause-circle';
        case 'broken': return 'times-circle';
        default: return 'question-circle';
      }
    }

    // Add event listeners (simplified for demo)
    function addEventListeners() {
      console.log('Event listeners added');
    }

    // Search Functionality
    document.querySelector('.search-box input').addEventListener('input', function(e) {
      const term = e.target.value.toLowerCase();
      document.querySelectorAll('.promise-list-item').forEach(item => {
        const title = item.querySelector('.promise-list-item__title-text p')?.textContent.toLowerCase() || '';
        item.style.display = title.includes(term) ? '' : 'none';
      });
      updateStats();
    });

    // Sort Functionality
    document.querySelector('.sort select').addEventListener('change', function() {
      const sortBy = this.value;
      const promiseList = document.getElementById('promise-list');
      const items = Array.from(promiseList.querySelectorAll('.promise-list-item'));
      items.sort((a, b) => {
        if (sortBy === 'last_updated') {
          const dateA = new Date(a.querySelector('.promise-list-item__status-info-date')?.textContent || '03-Mar-2025');
          const dateB = new Date(b.querySelector('.promise-list-item__status-info-date')?.textContent || '03-Mar-2025');
          return dateB - dateA;
        } else {
          const idA = a.querySelector('.promise-list-item__title-text p')?.textContent.match(/(\d+\.\d+\.\d+)/)?.[0] || '';
          const idB = b.querySelector('.promise-list-item__title-text p')?.textContent.match(/(\d+\.\d+\.\d+)/)?.[0] || '';
          return idA.localeCompare(idB);
        }
      });
      items.forEach(item => promiseList.appendChild(item));
      updateStats();
    });

    // Update Statistics
    function updateStats() {
      const items = document.querySelectorAll('.promise-list-item:not([style*="display: none"])');
      const keptCount = Array.from(items).filter(i => i.classList.contains('kept')).length;
      const inProgressCount = Array.from(items).filter(i => i.classList.contains('in-progress')).length;
      const notStartedCount = Array.from(items).filter(i => i.classList.contains('not-yet-rated')).length;
      const brokenCount = Array.from(items).filter(i => i.classList.contains('broken')).length;

      document.getElementById('kept-count').textContent = keptCount;
      document.getElementById('in-progress-count').textContent = inProgressCount;
      document.getElementById('not-started-count').textContent = notStartedCount;
      document.getElementById('broken-count').textContent = brokenCount;
    }
  </script>
</body>
</html>
