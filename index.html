<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ontario Promise Tracker</title>
  <!-- Google Fonts: Exo 2 and Roboto Condensed -->
  <link href="https://fonts.googleapis.com/css2?family=Exo+2&family=Roboto+Condensed&display=swap" rel="stylesheet">
  <!-- Font Awesome for Icons -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" integrity="sha512-9usAa10IRO0HhonpyAIVpjrylPvoDwiPUiKdWk5t3PyolY1cOd4DSE0Ga+ri4AuTroPR5aQvXU9xC6qOPnzFeg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <style>
    :root {
      --primary: #1a73e8; /* Blue */
      --background: #1a1a1a; /* Black */
      --text: #fff; /* White */
      --accent: #333; /* Grey */
      --shadow: rgba(0, 0, 0, 0.8);
      --status-kept: #00b300; /* Green */
      --status-in-progress: #ff9900; /* Orange */
      --status-not-started: #666; /* Grey */
      --status-broken: #FF0000; /* Red for broken */
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: 'Roboto Condensed', sans-serif;
      background: var(--background);
      color: var(--text);
      line-height: 1.5;
      padding: 0 20px;
    }
    a {
      color: var(--primary);
      text-decoration: none;
    }
    a:hover {
      text-decoration: underline;
    }

    /* Pop-up for Open Letter */
    .popup {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.85);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }
    .popup-content {
      background: var(--accent);
      padding: 40px;
      border-left: 5px solid var(--primary);
      max-width: 90vw;
      max-height: 90vh;
      overflow-y: auto;
      position: relative;
      color: var(--text);
      font-size: 1.2rem;
      line-height: 1.8;
    }
    .popup-content h2 {
      font-family: 'Exo 2', sans-serif;
      font-size: 2.5rem;
      text-transform: uppercase;
      margin-bottom: 20px;
      text-align: center;
    }
    .popup-content p {
      margin-bottom: 15px;
      text-align: justify;
    }
    .emphasis {
      color: var(--primary);
      font-weight: bold;
      text-transform: uppercase;
    }
    .signature {
      text-align: right;
      font-size: 1.5rem;
      margin-top: 30px;
      opacity: 0.8;
      font-style: italic;
    }
    .continue-btn {
      background: var(--primary);
      color: var(--text);
      border: none;
      padding: 15px 30px;
      cursor: pointer;
      font-family: 'Exo 2', sans-serif;
      font-size: 1.2rem;
      text-transform: uppercase;
      margin-top: 20px;
      transition: background 0.3s ease;
      display: block;
      margin-left: auto;
      margin-right: auto;
    }
    .continue-btn:hover {
      background: #0a63c8;
    }

    /* Header */
    header {
      background: linear-gradient(to right, #0a2463, #1a73e8);
      padding: 60px 0;
      text-align: center;
      box-shadow: 0 4px 10px var(--shadow);
    }
    header h1 {
      font-family: 'Exo 2', sans-serif;
      font-size: 4rem;
      text-transform: uppercase;
      letter-spacing: 3px;
      color: #fff;
      text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
    }

    /* Statistics Section */
    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin: 40px 0;
    }
    .stat-card {
      background: var(--accent);
      padding: 20px;
      text-align: center;
      border-top: 4px solid var(--primary);
      border-bottom: 2px solid var(--primary);
      transition: transform 0.3s ease;
    }
    .stat-card:hover {
      transform: translateY(-5px);
    }
    .stat-card i {
      font-size: 2.5rem;
      margin-bottom: 10px;
    }
    .stat-card.kept i { color: var(--status-kept); }
    .stat-card.in-progress i { color: var(--status-in-progress); }
    .stat-card.not-started i { color: var(--status-not-started); }
    .stat-card.broken i { color: var(--status-broken); }
    .stat-card h3 {
      font-family: 'Exo 2', sans-serif;
      font-size: 1.2rem;
      text-transform: uppercase;
    }
    .stat-card p {
      font-size: 2rem;
      font-weight: bold;
    }

    /* Filters */
    .filters {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin: 20px 0;
      padding: 15px;
      background: var(--accent);
      border-left: 5px solid var(--primary);
      position: sticky;
      top: 0;
      z-index: 10;
    }
    .search-box input {
      padding: 10px 15px;
      width: 300px;
      background: #222;
      border: 1px solid var(--primary);
      color: var(--text);
      font-family: 'Roboto Condensed', sans-serif;
      font-size: 1rem;
    }
    .search-box input:focus {
      outline: none;
      border-color: #fff;
    }
    .sort select {
      padding: 10px;
      background: #222;
      border: 1px solid var(--primary);
      color: var(--text);
      font-family: 'Roboto Condensed', sans-serif;
      font-size: 1rem;
    }

    /* Promise Table */
    .promise-table {
      width: 100%;
      border-collapse: collapse;
      margin: 20px 0;
    }
    .promise-table thead {
      background: #222;
      text-transform: uppercase;
      font-family: 'Exo 2', sans-serif;
    }
    .promise-table th {
      padding: 15px;
      text-align: left;
      border-bottom: 2px solid var(--primary);
    }
    .promise-table td {
      padding: 15px;
      border-bottom: 1px solid #444;
    }
    .promise-table tbody tr {
      background: var(--background);
      transition: background 0.3s ease;
    }
    .promise-table tbody tr:hover {
      background: #2a2a2a;
    }
    .status-icon {
      width: 25px;
      height: 25px;
      border-radius: 50%;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      color: #fff;
      font-size: 0.9rem;
    }
    .kept { background: var(--status-kept); }
    .in-progress { background: var(--status-in-progress); }
    .not-yet-rated { background: var(--status-not-started); }
    .broken { background: var(--status-broken); }
    .details-btn {
      background: var(--primary);
      color: var(--text);
      border: none;
      padding: 8px 15px;
      cursor: pointer;
      font-family: 'Roboto Condensed', sans-serif;
      font-size: 0.9rem;
      text-transform: uppercase;
      transition: background 0.3s ease;
    }
    .details-btn:hover {
      background: #0a63c8;
    }
    .promise-details td {
      background: #2a2a2a;
      font-style: italic;
    }

    /* Footer */
    .party-info {
      background: var(--accent);
      padding: 20px;
      text-align: center;
      margin: 40px 0;
      border-top: 2px solid var(--primary);
    }
    .party-info h3 {
      font-family: 'Exo 2', sans-serif;
      font-size: 1.5rem;
      margin-bottom: 10px;
    }

    /* Screen Reader Only */
    .sr-only {
      position: absolute;
      width: 1px;
      height: 1px;
      padding: 0;
      margin: -1px;
      overflow: hidden;
      clip: rect(0,0,0,0);
      border: 0;
    }

    /* Loading/Error Message */
    #loading-message {
      text-align: center;
      padding: 20px;
      font-size: 1.2rem;
    }
  </style>
</head>
<body>
  <!-- Open Letter Pop-Up -->
  <div class="popup" id="popup">
    <div class="popup-content">
      <h2>Open Letter to the PC Party of Ontario</h2>
      <p>To the PC Party of Ontario,</p>
      <p>In a polling location, I witnessed diverse amounts of people from every background, ethnicity, gender, and religion. From the bright-eyed curiosity of children, the resolute determination of young adults casting their first ever ballot, to mothers and fathers balancing civic duty with familial love, and seniors whose wisdom spans generations, each person came driven by a passion to vote for a better tomorrow.</p>
      <p>I witnessed acts of kindness that show the very essence of our Canadian spirit. Strangers holding doors open for one another, exchanging warm smiles and sharing hopeful words about the future. In every corner of the polling station, there was a unifying truth: each vote was not just a mark on a ballot but a testament to the enduring belief in democracy and the hope for a brighter future.</p>
      <p>I implore you, as the custodians of our province’s destiny, to approach your tenure with unwavering integrity and transparency. The promises you made during your campaigns are not mere political talking points; they are lifelines for families striving for better education, affordable housing and cheaper groceries; for individuals yearning for accessible healthcare; for communities working toward sustainable growth; and for the marginalized desiring equitable opportunities. These commitments embody the dreams and aspirations of every Ontarian who has placed their trust in you.</p>
      <p>So when the confetti settles and the headlines fade, remember the man who cast his vote from a hospice bed, his ballot a final act of faith. Recall the student who skipped lunch to join the line, believing that a single vote could mend their hunger. Recall the seniors that made it their day's mission to go out and cast their vote.</p>
      <p>To you who will lead: carry these people in your very bones. Let them echo in every podium speech, every policy debate, every late night discussion. You are not merely inheriting power; you are entrusted with hope. Do not dilute it with empty rhetoric or betray it through complacency.</p>
      <p>Be the leader who sees a parent’s silent tears at every cut to education; who hears the distant roar of wildfires in every compromise on the environment; who feels the tremor in a senior’s hand when housing becomes a luxury; who sees the young struggling with their mental and physical health due to inadequate healthcare.</p>
      <p class="emphasis">This is your task. Be bold. Be compassionate. Be accountable. But above all, be worthy of them.</p>
      <div class="signature">A Concerned Citizen of Ontario</div>
      <button class="continue-btn" onclick="hidePopup()" aria-label="Continue to Tracker">Continue</button>
    </div>
  </div>

  <!-- Header -->
  <header>
    <h1>Ontario Promise Tracker</h1>
  </header>

  <!-- Statistics -->
  <div class="stats">
    <div class="stat-card kept">
      <i class="fas fa-check-circle"></i>
      <h3>Kept</h3>
      <p id="kept-count">0</p>
    </div>
    <div class="stat-card in-progress">
      <i class="fas fa-hourglass-half"></i>
      <h3>In Progress</h3>
      <p id="in-progress-count">0</p>
    </div>
    <div class="stat-card not-started">
      <i class="fas fa-pause-circle"></i>
      <h3>Not Started</h3>
      <p id="not-started-count">0</p>
    </div>
    <div class="stat-card broken">
      <i class="fas fa-times-circle"></i>
      <h3>Broken</h3>
      <p id="broken-count">0</p>
    </div>
  </div>

  <!-- Filters -->
  <div class="filters">
    <div class="search-box">
      <input type="text" placeholder="Search Promises..." aria-label="Search promises">
    </div>
    <div class="sort">
      <select aria-label="Sort by">
        <option value="last_updated">Sort by Last Updated</option>
        <option value="promise_id">Sort by Promise ID</option>
      </select>
    </div>
  </div>

  <!-- Loading/Error Message -->
  <div id="loading-message">Loading promises...</div>

  <!-- Promise Table -->
  <table class="promise-table" style="display: none;">
    <thead>
      <tr>
        <th>Status</th>
        <th>Promise ID</th>
        <th>Title</th>
        <th>Last Updated</th>
        <th>Sources</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody id="promise-table-body">
      <!-- Promises will be dynamically loaded here -->
    </tbody>
  </table>

  <!-- Party Info -->
  <footer class="party-info">
    <h3>Current Party: PC Party of Ontario</h3>
    <p><strong>Leader:</strong> Doug Ford</p>
  </footer>

  <script>
    // Show pop-up and fetch promises on load
    document.addEventListener('DOMContentLoaded', function() {
      document.getElementById('popup').style.display = 'flex';
      fetchPromises();
    });

    // Hide pop-up
    function hidePopup() {
      document.getElementById('popup').style.display = 'none';
    }

    // Close pop-up when clicking outside
    document.getElementById('popup').addEventListener('click', function(e) {
      if (e.target === this) hidePopup();
    });

    // Fetch promises from a proxy endpoint
    async function fetchPromises() {
      const loadingMessage = document.getElementById('loading-message');
      const table = document.querySelector('.promise-table');
      loadingMessage.textContent = 'Loading promises...';
      table.style.display = 'none';

      // Use a proxy to fetch Polimeter data
      const proxyUrl = 'https://api.allorigins.win/get?url=' + encodeURIComponent('https://www.polimeter.org/en/ford?gb=ungrouped&sb=progress_desc');
      
      try {
        const response = await fetch(proxyUrl);
        if (!response.ok) throw new Error('Network response was not ok');
        const data = await response.json();
        const htmlContent = data.contents;

        // Parse the HTML content (simplified parsing for demo)
        const parser = new DOMParser();
        const doc = parser.parseFromString(htmlContent, 'text/html');
        const promiseElements = doc.querySelectorAll('.promise-item'); // Hypothetical selector - adjust based on Polimeter's structure
        
        const promises = [];
        promiseElements.forEach(elem => {
          const promise = {
            id: elem.querySelector('.promise-id')?.textContent || 'Unknown',
            title: elem.querySelector('.promise-title')?.textContent || 'Unknown Promise',
            status: elem.querySelector('.promise-status')?.textContent.toLowerCase() || 'not-yet-rated',
            last_updated: elem.querySelector('.promise-date')?.textContent || '03-Mar-2025',
            source_url: elem.querySelector('a')?.href || 'https://www.polimeter.org/en/ford',
            source_name: 'Polimeter',
            details: elem.querySelector('.promise-details')?.textContent || 'No details available'
          };
          promises.push(promise);
        });

        // If no promises found, use fallback data
        if (promises.length === 0) {
          promises.push(...getFallbackPromises());
        }

        renderPromises(promises);
        loadingMessage.style.display = 'none';
        table.style.display = 'table';
      } catch (error) {
        console.error('Error fetching promises:', error);
        loadingMessage.textContent = 'Failed to load promises. Please try again later.';
        renderPromises(getFallbackPromises()); // Fallback to sample data
        table.style.display = 'table';
      }
    }

    // Fallback promises if fetch fails
    function getFallbackPromises() {
      return [
        {
          id: "2.04.002",
          title: "Invest $1 billion over the next three years to boost skilled trades.",
          status: "in-progress",
          last_updated: "22-Jul-2024",
          source_url: "https://www.ontario.ca/page/ontario-budget-2022",
          source_name: "Ontario Budget 2022",
          details: "Fully funded initiative launched in 2022, with programs active across Ontario."
        },
        {
          id: "2.04.021",
          title: "Build Highway 413 to reduce traffic and congestion in the Greater Toronto Area (GTA).",
          status: "broken",
          last_updated: "17-Jul-2024",
          source_url: "https://news.ontario.ca/en/release/1003189",
          source_name: "Infrastructure Update",
          details: "Construction delayed indefinitely due to budget constraints."
        },
        {
          id: "1.06.022",
          title: "Clean up our communities: Commit resources to reduce garbage in our neighbourhoods and parks.",
          status: "not-yet-rated",
          last_updated: "01-Jan-2025",
          source_url: "https://www.ontario.ca/page/community-clean-up",
          source_name: "Community Clean-Up Program",
          details: "Initiative announced but no action taken yet."
        }
      ];
    }

    // Render promises into the table
    function renderPromises(promises) {
      const tbody = document.getElementById('promise-table-body');
      tbody.innerHTML = '';
      promises.forEach(promise => {
        const row = document.createElement('tr');
        row.className = `promise-row ${promise.status}`;
        row.dataset.status = promise.status;
        row.innerHTML = `
          <td><span class="status-icon ${promise.status}"><i class="fas fa-${getIcon(promise.status)}"></i></span><span class="sr-only">${promise.status}</span></td>
          <td>${promise.id}</td>
          <td>${promise.title}</td>
          <td>${promise.last_updated}</td>
          <td><a href="${promise.source_url}" target="_blank">${promise.source_name}</a></td>
          <td><button class="details-btn">Details</button></td>
        `;
        tbody.appendChild(row);

        const detailsRow = document.createElement('tr');
        detailsRow.className = 'promise-details';
        detailsRow.style.display = 'none';
        detailsRow.innerHTML = `<td colspan="6">Details: ${promise.details}</td>`;
        tbody.appendChild(detailsRow);
      });
      updateStats();
      addEventListeners();
    }

    function getIcon(status) {
      switch (status) {
        case 'kept': return 'check-circle';
        case 'in-progress': return 'hourglass-half';
        case 'not-yet-rated': return 'pause-circle';
        case 'broken': return 'times-circle';
        default: return 'question-circle';
      }
    }

    // Add event listeners to details buttons
    function addEventListeners() {
      document.querySelectorAll('.details-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const details = this.closest('tr').nextElementSibling;
          details.style.display = details.style.display === 'none' ? '' : 'none';
          this.textContent = details.style.display === 'none' ? 'Details' : 'Hide';
        });
      });
    }

    // Search Functionality
    document.querySelector('.search-box input').addEventListener('input', function(e) {
      const term = e.target.value.toLowerCase();
      document.querySelectorAll('.promise-row').forEach(row => {
        const title = row.querySelector('td:nth-child(3)').textContent.toLowerCase();
        const display = title.includes(term) ? '' : 'none';
        row.style.display = display;
        row.nextElementSibling.style.display = display;
      });
      updateStats();
    });

    // Sort Functionality
    document.querySelector('.sort select').addEventListener('change', function() {
      const sortBy = this.value;
      const tbody = document.getElementById('promise-table-body');
      const rows = Array.from(tbody.querySelectorAll('.promise-row'));
      rows.sort((a, b) => {
        if (sortBy === 'last_updated') {
          const dateA = new Date(a.querySelector('td:nth-child(4)').textContent);
          const dateB = new Date(b.querySelector('td:nth-child(4)').textContent);
          return dateB - dateA;
        } else {
          const idA = a.querySelector('td:nth-child(2)').textContent;
          const idB = b.querySelector('td:nth-child(2)').textContent;
          return idA.localeCompare(idB);
        }
      });
      rows.forEach(row => {
        tbody.appendChild(row);
        tbody.appendChild(row.nextElementSibling);
      });
      updateStats();
    });

    // Update Statistics
    function updateStats() {
      const rows = document.querySelectorAll('.promise-row:not([style*="display: none"])');
      document.getElementById('kept-count').textContent = Array.from(rows).filter(r => r.dataset.status === 'kept').length;
      document.getElementById('in-progress-count').textContent = Array.from(rows).filter(r => r.dataset.status === 'in-progress').length;
      document.getElementById('not-started-count').textContent = Array.from(rows).filter(r => r.dataset.status === 'not-yet-rated').length;
      document.getElementById('broken-count').textContent = Array.from(rows).filter(r => r.dataset.status === 'broken').length;
    }
  </script>
</body>
</html>
